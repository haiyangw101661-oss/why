<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç»™å®è´çš„å°App</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- å­—ä½“ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(-45deg, #fbc2eb, #a6c1ee, #fddb92, #fbc2eb);
      background-size: 400% 400%;
      animation: gradientBG 30s ease infinite;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .particle {
      position: absolute;
      font-size: 1.4rem;
      animation: particle-fall linear forwards;
      top: -10%;
      pointer-events: none;
    }

    @keyframes particle-fall {
      0% {
        top: -10%;
        opacity: 1;
        transform: translateX(0) rotate(0deg);
      }
      100% {
        top: 110%;
        opacity: 0;
        transform: translateX(20px) rotate(60deg);
      }
    }

    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 60;
      background-color: rgba(0, 0, 0, 0.3);
      color: white;
      border-radius: 9999px;
      padding: 0.75rem;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .carousel-btn:hover {
      background-color: rgba(0, 0, 0, 0.6);
      transform: translateY(-50%) scale(1.08);
    }

    #gallery-image {
      max-width: 90vw;
      max-height: 90vh;
      object-fit: contain;
      border-radius: 1.5rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .jello-button {
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      box-shadow: 0 4px 15px 0 rgba(100, 100, 100, 0.2);
    }
    .jello-button:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px 0 rgba(100, 100, 100, 0.3);
    }
    .jello-button:active {
      transform: scale(0.95);
    }

    .font-display {
      font-family: 'Dancing Script', cursive;
    }
  </style>
</head>
<body class="min-h-screen overflow-y-auto">

  <!-- ç²’å­å®¹å™¨ -->
  <div id="particle-container" class="absolute inset-0 -z-10 overflow-hidden"></div>

  <!-- ä¸»å†…å®¹ -->
  <div class="relative min-h-screen flex flex-col items-center px-4 py-8">
    <div class="w-full max-w-xl space-y-4">

      <!-- ä¸»å¡ç‰‡ -->
      <div class="w-full p-6 bg-white/80 backdrop-blur-md rounded-3xl shadow-2xl shadow-pink-200/50">
        <h1 class="font-display text-4xl md:text-5xl font-bold text-pink-600 text-center">
          ç»™æˆ‘çš„å®è´
        </h1>
        <p class="mt-2 text-center text-sm text-gray-600">
          ç”Ÿæ´»ä¸­çš„ä¸€äº›å°ç¾å¥½ï¼Œéƒ½å·å·è—åœ¨è¿™é‡Œã€‚
        </p>

        <!-- ä»Šæ—¥å°æƒ…è¯ -->
        <section class="mt-4 p-4 rounded-2xl bg-pink-50/90">
          <p class="text-xs text-gray-400 mb-1">ä»Šæ—¥å°æƒ…è¯</p>
          <p id="today-quote-text" class="text-base md:text-lg font-semibold text-gray-800">
            åŠ è½½ä¸­...
          </p>
        </section>

        <!-- å¿ƒæƒ…é¢æ¿ -->
        <section class="mt-4 p-4 rounded-2xl bg-white/90 shadow-inner">
          <div class="flex items-center justify-between mb-3">
            <h2 class="text-sm font-semibold text-gray-800">ç°åœ¨çš„å¿ƒæƒ…æ˜¯ï¼Ÿ</h2>
            <span class="text-xs text-gray-400">ç‚¹ä¸€ç‚¹,æˆ‘æ¥åº”æ´</span>
          </div>
          <div class="grid grid-cols-4 gap-2 text-xs md:text-sm">
            <button data-mood="tired" class="mood-btn py-2 rounded-xl bg-pink-50 jello-button">ç´¯ç´¯ ğŸ¥±</button>
            <button data-mood="sad" class="mood-btn py-2 rounded-xl bg-indigo-50 jello-button">éš¾è¿‡ ğŸ˜¢</button>
            <button data-mood="happy" class="mood-btn py-2 rounded-xl bg-amber-50 jello-button">å¼€å¿ƒ ğŸ˜†</button>
            <button data-mood="anxious" class="mood-btn py-2 rounded-xl bg-teal-50 jello-button">ç„¦è™‘ ğŸ˜–</button>
          </div>
          <!-- V15: ä¿®å¤ç©ºç™½é—®é¢˜, å‡å°æœ€å°é«˜åº¦ -->
          <p id="mood-reply" class="mt-3 text-sm text-gray-700 min-h-[1.5rem]">ç‚¹ä¸€ä¸ªä¸Šé¢çš„å¿ƒæƒ…æŒ‰é’®è¯•è¯•çœ‹ï¼Ÿ</p>
        </section>

        <!-- V14: å››å¤§åŠŸèƒ½æŒ‰é’® (2x2 å¸ƒå±€) -->
        <section class="mt-4 grid grid-cols-2 gap-3">
          <button id="nav-love" class="jello-button w-full py-3 md:py-4 px-3 rounded-2xl bg-gradient-to-r from-pink-500 to-rose-500 text-white text-sm md:text-base font-semibold flex items-center justify-center gap-2">
            <span>ğŸ’Œ</span><span>çˆ±çš„ä¾¿ç­¾</span>
          </button>
          <button id="nav-enc" class="jello-button w-full py-3 md:py-4 px-3 rounded-2xl bg-gradient-to-r from-purple-500 to-indigo-500 text-white text-sm md:text-base font-semibold flex items-center justify-center gap-2">
            <span>âœ¨</span><span>éœ€è¦é¼“åŠ±</span>
          </button>
          <button id="nav-praise" class="jello-button w-full py-3 md:py-4 px-3 rounded-2xl bg-gradient-to-r from-teal-400 to-cyan-500 text-white text-sm md:text-base font-semibold flex items-center justify-center gap-2">
            <span>ğŸ‰</span><span>æ¯æ—¥ä¸€å¤¸</span>
          </button>
          
          <!-- V14: æ¢å¤è‡ªåŠ¨åŠ è½½åŠŸèƒ½ -->
          <button id="memory-open" class="jello-button w-full py-3 md:py-4 px-3 rounded-2xl bg-gradient-to-r from-amber-500 to-orange-500 text-white text-sm md:text-base font-semibold flex items-center justify-center gap-2 opacity-50 cursor-not-allowed" disabled>
            <span>ğŸ’–</span><span>æ­£åœ¨åŠ è½½...</span>
          </button>
        </section>

        <!-- ä»Šæ—¥æ‰­ä¸€æ‰­ -->
        <section class="mt-4 p-4 rounded-2xl bg-white/90 shadow-inner">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs text-gray-400">ä»Šæ—¥æ‰­ä¸€æ‰­</p>
              <p class="text-sm md:text-base font-semibold text-gray-800">æˆ³ä¸€ä¸‹æ‹†ç›²ç›’</p>
            </div>
            <button id="gacha-btn" class="jello-button px-3 py-2 rounded-xl bg-gradient-to-r from-pink-500 to-purple-500 text-white text-xs font-semibold">
              æ‰­ä¸€æ‰­
            </button>
          </div>
          <!-- V15: ä¿®å¤ç©ºç™½é—®é¢˜, å‡å°æœ€å°é«˜åº¦ -->
          <p id="gacha-text" class="mt-2 text-sm text-gray-700 min-h-[1.5rem]"></p>
          <p id="gacha-count" class="mt-1 text-xs text-gray-400 cursor-pointer"></p>
        </section>
      </div>

      <p class="mt-4 text-center text-[11px] text-gray-400">
        Made with â¤ï¸ by why
      </p>
    </div>
  </div>

  <!-- æ–‡æœ¬å¼¹çª—ï¼šçˆ±çš„ä¾¿ç­¾ / é¼“åŠ± / å¤¸å¤¸ / æç¤º -->
  <div id="text-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/40 px-6 backdrop-blur-sm">
    <div class="bg-white rounded-3xl p-6 max-w-sm w-full text-center shadow-xl">
      <div id="text-modal-icon" class="text-4xl mb-3">ğŸ’Œ</div>
      <p id="text-modal-content" class="text-lg text-gray-800"></p>
      <button id="text-modal-close" class="mt-4 px-4 py-2 rounded-xl bg-pink-500 text-white text-sm font-semibold">
        å¥½ ~
      </button>
    </div>
  </div>

  <!-- ç…§ç‰‡ç”»å»Šå¼¹çª— -->
  <div id="gallery-modal" class="fixed inset-0 z-40 hidden items-center justify-center p-4">
    <div id="gallery-overlay" class="absolute inset-0 bg-black/55 backdrop-blur-sm"></div>

    <button id="gallery-close" class="absolute top-4 right-4 z-50 text-white bg-black/30 hover:bg-black/60 rounded-full p-2 transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <button id="gallery-prev" class="carousel-btn left-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>

    <button id="gallery-next" class="carousel-btn right-4">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </button>

    <div class="relative flex justify-center items-center w-full h-full">
      <img id="gallery-image" src="" alt="æˆ‘ä»¬çš„å›å¿†" />
      <!-- V14: ç§»é™¤äº†é¡µç æŒ‡ç¤ºå™¨ -->
      <div id="gallery-indicator" class="absolute bottom-6 left-1/2 -translate-x-1/2 text-xs text-white/80 hidden"></div>
    </div>
  </div>

  <script>
    // V14: æ¢å¤ GitHub API è‡ªåŠ¨åŠ è½½
    const GITHUB_USERNAME = 'haiyangw101661-oss';
    const GITHUB_REPO_NAME = 'why';

    /* ---------- æ–‡æ¡ˆæ•°æ® ---------- */
    
    // æ¯æ—¥å°æƒ…è¯
    const dailyQuotes = [
      "è¿™åªæ˜¯ä¸€ä¸ªå°æé†’ï¼šæˆ‘ä»Šå¤©ä¹Ÿå¾ˆå–œæ¬¢ä½ ã€‚",
      "å¦‚æœä»Šå¤©ä¸å¤ªé¡ºåˆ©ï¼Œå°±æŠŠä¸é¡ºåˆ©åˆ†ä¸€ç‚¹ç»™æˆ‘ã€‚",
      "æ— è®ºä½ åœ¨å“ªä¸ªåŸå¸‚ï¼Œæˆ‘éƒ½åœ¨è¿™è¾¹æ›¿ä½ è¯´æ™šå®‰ã€‚",
      "ä½ å°±åƒé˜³å…‰ä¸€æ ·ï¼Œç…§äº®äº†æˆ‘çš„ä¸–ç•Œã€‚",
      "å’Œä½ åœ¨ä¸€èµ·ï¼Œæ¯ä¸€å¤©éƒ½æ˜¯æƒ…äººèŠ‚ã€‚"
    ];

    // å¿ƒæƒ…å›å¤
    const moodReplies = {
      tired: [
        "ç´¯ç´¯å°±å…ˆä¸ç”¨é€å¼ºå•¦ï¼Œå–æ°´ã€ä¼¸ä¼¸æ‡’è…°ï¼Œå‰©ä¸‹çš„äº¤ç»™æˆ‘å’Œæ—¶é—´ã€‚",
        "ä»Šå¤©å¦‚æœåªæƒ³å½“ä¸€æ¡å’¸é±¼ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘è´Ÿè´£å–œæ¬¢ä½ å°±å¥½ã€‚",
        "å·¥ä½œå¯ä»¥å…ˆæ”¾ä¸€æ”¾ï¼Œä½†ç…§é¡¾å¥½è‡ªå·±è¿™ä»¶äº‹æˆ‘ä»¬ä¸èƒ½ä¸‹ç­ã€‚",
        "ä½ å·²ç»å¾ˆæ£’äº†ï¼Œå…è®¸è‡ªå·±æ…¢ä¸€ç‚¹ã€æ‡’ä¸€ç‚¹ã€å–˜å£æ°”ã€‚",
        "é—­ä¸Šçœ¼ç›æƒ³è±¡ä¸€ä¸‹æˆ‘åœ¨ä½ æ—è¾¹ç»™ä½ ç›–è¢«å­ï¼Œå°±æ˜¯ç°åœ¨ã€‚",
      ],
      sad: [
        "æƒ³å“­å°±å“­ä¸€ä¼šå„¿ï¼Œæˆ‘ä¸ä¼šå«Œä½ çƒ¦ï¼Œåªä¼šæ›´æƒ³æŠ±æŠ±ä½ ã€‚",
        "æƒ…ç»ªæœ‰ç‚¹ä½è½ä¸ä»£è¡¨ä½ ä¸å¤Ÿå¥½ï¼Œåªæ˜¯ä»Šå¤©é£æœ‰ç‚¹å¤§è€Œå·²ã€‚",
        "éš¾è¿‡çš„æ—¶å€™åˆ«æ€¥ç€åšå¼ºï¼Œå¯ä»¥å…ˆåšä¸€ä¸ªéœ€è¦è¢«ç…§é¡¾çš„å°æœ‹å‹ã€‚",
        "ä½ å¯ä»¥æš‚æ—¶ä»€ä¹ˆéƒ½ä¸æƒ³è§£å†³ï¼Œåªè¦å…ˆä¿è¯è‡ªå·±å¹³å®‰å…¥ç¡ã€‚",
        "å“ªæ€•ä½ ä¸€æ•´å¤©éƒ½åœ¨emoï¼Œæˆ‘è¿™è¾¹å¯¹ä½ çš„å–œæ¬¢ä¹Ÿä¸ä¼šæ‰“æŠ˜ã€‚",
      ],
      happy: [
        "æŠŠè¿™ä»½å¼€å¿ƒæ‰“åŒ…ä¸€å°ä»½ç»™æˆ‘ï¼Œå‰©ä¸‹çš„éƒ½ç•™ç»™ä½ è‡ªå·±ã€‚",
        "æˆ‘å°±çŸ¥é“ï¼Œä½ è¿™ä¹ˆå¯çˆ±ï¼Œå®‡å®™æ€»ä¼šå¤šç…§é¡¾ä½ ä¸€ç‚¹ã€‚",
        "å¿«è®°ä½ç°åœ¨è¿™ä»½å¿«ä¹ï¼Œä»¥åéš¾è¿‡çš„æ—¶å€™æˆ‘æ‹¿å‡ºæ¥è¿˜ç»™ä½ ã€‚",
        "ä½ ä¸€é«˜å…´ï¼Œæˆ‘å°±æƒ³åœ¨æ—¥å†ä¸Šç”»ä¸€ä¸ªå¤§å¤§çš„çˆ±å¿ƒã€‚",
        "å¼€å¿ƒçš„æ—¶å€™è¯·ç‹ ç‹ åœ°å¤¸è‡ªå·±å‡ å¥ï¼Œå› ä¸ºä½ çœŸçš„å¾ˆå€¼å¾—ã€‚",
      ],
      anxious: [
        "åˆ«æ‹…å¿ƒï¼Œå¤©å¡Œä¸‹æ¥æœ‰æˆ‘é¡¶ç€ï¼",
        "ç›¸ä¿¡è‡ªå·±ï¼Œä½ æ¯”æƒ³è±¡ä¸­æ›´å¼ºå¤§ã€‚",
        "æ²¡å…³ç³»ï¼Œæ…¢æ…¢æ¥ï¼Œæˆ‘ä¼šä¸€ç›´é™ªç€ä½ ã€‚",
        "ä½ åšçš„æ¯ä¸€ä¸ªå†³å®šï¼Œæˆ‘éƒ½æ”¯æŒã€‚",
        "æ·±å‘¼å¸ï¼Œç„¶åæƒ³è±¡æˆ‘æ­£åœ¨æŠŠä½ çš„ç„¦è™‘éƒ½æŠ±èµ°ã€‚",
      ]
    };
    
    // ä¸‰å¤§åŠŸèƒ½æŒ‰é’®çš„è¯­å½•
    const quotes = {
        btn1: [
            'è¿™åªæ˜¯ä¸€ä¸ªæé†’ï¼šæˆ‘æ¯æ—¶æ¯åˆ»éƒ½åœ¨æƒ³ä½ ï¼',
            'é‡åˆ°ä½ ï¼Œæ˜¯æˆ‘è¿™è¾ˆå­æœ€å¹¸è¿çš„äº‹ã€‚',
            'ä½ çš„ç¬‘å®¹ï¼Œæ˜¯æˆ‘ä¸€å¤©çš„åŠ¨åŠ›ï¼',
            'ä½ å°±åƒé˜³å…‰ä¸€æ ·ï¼Œç…§äº®äº†æˆ‘çš„ä¸–ç•Œã€‚',
            'æœ‰ä½ åœ¨èº«è¾¹ï¼Œå†å¤§çš„å›°éš¾ä¹Ÿä¸æ€•ã€‚',
            'æ¯ä¸€æ¬¡å‘¼å¸ï¼Œéƒ½ä¸ºä½ å¿ƒåŠ¨ã€‚',
            'ä½ çš„å‡ºç°ï¼Œæ²»æ„ˆäº†æˆ‘æ‰€æœ‰çš„ä¸å¼€å¿ƒã€‚',
            'æƒ³æŠŠä¸–ç•Œä¸Šæ‰€æœ‰çš„æ¸©æŸ”éƒ½ç»™ä½ ã€‚',
            'å’Œä½ åœ¨ä¸€èµ·ï¼Œæ¯ä¸€å¤©éƒ½æ˜¯æƒ…äººèŠ‚ã€‚'
        ],
        btn2: [
            'ä½ å·²ç»è¶…çº§æ£’äº†ï¼ç´¯äº†å°±æ­‡ä¸€æ­‡ï¼Œæˆ‘æ°¸è¿œæ˜¯ä½ æœ€åšå®çš„åç›¾ã€‚',
            'åˆ«æ‹…å¿ƒï¼Œå¤©å¡Œä¸‹æ¥æœ‰æˆ‘é¡¶ç€ï¼',
            'ç›¸ä¿¡è‡ªå·±ï¼Œä½ æ¯”æƒ³è±¡ä¸­æ›´å¼ºå¤§ã€‚',
            'ä½ åšçš„æ¯ä¸€ä¸ªå†³å®šï¼Œæˆ‘éƒ½æ”¯æŒã€‚',
            'ç´¯çš„æ—¶å€™ï¼Œæƒ³æƒ³æˆ‘ï¼Œæˆ‘æ˜¯ä½ çš„èƒ½é‡è¡¥ç»™ç«™ã€‚',
            'æ²¡å…³ç³»ï¼Œæ…¢æ…¢æ¥ï¼Œæˆ‘ä¼šä¸€ç›´é™ªç€ä½ ã€‚',
            'ä½ çš„åŠªåŠ›ï¼Œæˆ‘éƒ½çœ‹åœ¨çœ¼é‡Œï¼ŒçœŸçš„ä¸ºä½ éª„å‚²ã€‚',
            'è®°å¾—çˆ±è‡ªå·±å¤šä¸€ç‚¹ï¼Œä½ å€¼å¾—ä¸–é—´æ‰€æœ‰çš„ç¾å¥½ã€‚',
            'ä»»ä½•æ—¶å€™ï¼Œæˆ‘éƒ½ä¼šæ˜¯ç¬¬ä¸€ä¸ªä¸ºä½ åŠ æ²¹çš„äººã€‚'
        ],
        btn3: [
            'ä»Šæ—¥ä»½å¤¸å¥–ï¼šä½ çš„çœ¼ç›é‡Œæœ‰æ˜Ÿæ˜Ÿï¼',
            'æ€ä¹ˆä¼šæœ‰äººè¿ç”Ÿæ°”çš„æ ·å­éƒ½è¿™ä¹ˆå¯çˆ±ï¼',
            'ä½ æ˜¯æˆ‘è§è¿‡æœ€æœ‰å“å‘³çš„äººï¼',
            'ä½ çš„å£°éŸ³å°±åƒå¤©ç±ï¼Œè®©æˆ‘ç™¾å¬ä¸åŒã€‚',
            'ä½ çš„å‘ä¸éƒ½é€éœ²ç€è¿·äººçš„é­…åŠ›ã€‚',
            'ç©¿ä»€ä¹ˆéƒ½å¥½çœ‹ï¼Œç®€ç›´æ˜¯è¡Œèµ°çš„ç”»æŠ¥ã€‚',
            'ä½ çš„å–„è‰¯å’Œæ¸©æŸ”ï¼Œæ˜¯è¿™ä¸ªä¸–ç•Œæœ€å®è´µçš„è´¢å¯Œã€‚',
            'èªæ˜åˆå¯çˆ±ï¼Œæ€ä¹ˆä¼šæœ‰è¿™ä¹ˆå®Œç¾çš„äººï¼',
            'è·Ÿä½ åœ¨ä¸€èµ·ï¼Œæˆ‘æ„Ÿè§‰è‡ªå·±ä¹Ÿå˜å¾—æ›´å¥½äº†ã€‚'
        ]
    };
    
    // æ‰­è›‹æœºæ–‡æ¡ˆ
    const gachaReplies = [
        "å¥–åŠ±ä½ ä»Šå¤©å¯ä»¥äº²æˆ‘ä¸€ä¸‹ (éš”ç©ºçš„ä¹Ÿç®—)",
        "è§£é”æ–°æˆå°±ï¼šä»Šå¤©ä¹Ÿæ˜¯è¶…å¯çˆ±çš„ä¸€å¤©ï¼",
        "æ­å–œæŠ½ä¸­ï¼šä¸€ä¸ªå¤§å¤§çš„éš”ç©ºæ‹¥æŠ±ï¼",
        "ä½ æŠ½ä¸­äº†ä¸€å¼ â€œå·æ‡’åˆ¸â€ï¼Œä»Šå¤©å¯ä»¥æ—©ç‚¹ä¼‘æ¯ï¼",
        "å“‡ï¼æ˜¯â€œå¥½è¿çˆ†æ£šå¡â€ï¼Œä»Šå¤©ä¸€å®šä¼šå¾ˆé¡ºåˆ©ï¼",
        "æŠ½ä¸­â€œè¢«çˆ±å¡â€ï¼Œè¯´æ˜æˆ‘ä»Šå¤©åˆå¤šçˆ±äº†ä½ ä¸€ç‚¹ç‚¹ã€‚",
        "éšè—æ¬¾ï¼šè¢«æˆ‘å‘ç°ä½ åˆåœ¨å·å·å¯çˆ±äº†ï¼"
    ];
    
    /* ---------- çŠ¶æ€å˜é‡ ---------- */
    // V14: æ¢å¤è‡ªåŠ¨åŠ è½½
    let photoLinks = []; 
    let gachaCount = 0; // V16: ä» localStorage åŠ è½½
    
    // è½®æ’­å›¾çŠ¶æ€ (åªç”¨äºç…§ç‰‡)
    let galleryCurrentList = [];
    let galleryCurrentIndex = 0;
    
    // ç²’å­ç±»å‹æ•°ç»„
    const particleTypes = ['ğŸ’–', 'âœ¨', 'ğŸŒ¸', 'ğŸŒŸ'];

    /* ---------- è·å–å…ƒç´  ---------- */
    const particleContainer = document.getElementById('particle-container');
    const todayQuoteText = document.getElementById('today-quote-text');
    const moodReplyText = document.getElementById('mood-reply');
    const moodButtons = document.querySelectorAll('.mood-btn');
    
    const gachaBtn = document.getElementById('gacha-btn');
    const gachaText = document.getElementById('gacha-text');
    const gachaCountText = document.getElementById('gacha-count');

    const navLove = document.getElementById('nav-love');
    const navEnc = document.getElementById('nav-enc');
    const navPraise = document.getElementById('nav-praise');
    const memoryOpen = document.getElementById('memory-open');

    // æ–‡æœ¬å¼¹çª—
    const textModal = document.getElementById('text-modal');
    const textModalIcon = document.getElementById('text-modal-icon');
    const textModalContent = document.getElementById('text-modal-content');
    const textModalClose = document.getElementById('text-modal-close');
    
    // ç…§ç‰‡ç”»å»Šå¼¹çª—
    const galleryModal = document.getElementById('gallery-modal');
    const galleryOverlay = document.getElementById('gallery-overlay');
    const galleryClose = document.getElementById('gallery-close');
    const galleryPrev = document.getElementById('gallery-prev');
    const galleryNext = document.getElementById('gallery-next');
    const galleryImage = document.getElementById('gallery-image');
    const galleryIndicator = document.getElementById('gallery-indicator');


    /* ---------- è¾…åŠ©å‡½æ•° ---------- */
    function getRandomItem(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
    }
    
    function shuffleArray(array) {
        let newArr = [...array];
        for (let i = newArr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
        }
        return newArr;
    }
    
    /* ---------- å¼¹çª—åŠŸèƒ½ ---------- */

    // 1. æ–‡æœ¬å¼¹çª— (ç”¨äºè¯­å½•ã€æç¤º)
    function showTextModal(icon, message) {
        textModalIcon.textContent = icon;
        textModalContent.textContent = message;
        textModal.classList.remove('hidden');
        textModal.classList.add('flex');
    }
    function hideTextModal() {
        textModal.classList.add('hidden');
        textModal.classList.remove('flex');
    }

    // 2. ç…§ç‰‡ç”»å»Š (ç”¨äºâ€œæˆ‘ä»¬çš„å›å¿†â€)
    function displayGalleryItem() {
        if (galleryCurrentList.length === 0) return;
        galleryImage.src = galleryCurrentList[galleryCurrentIndex];
        // V14: ç§»é™¤äº†é¡µç æŒ‡ç¤ºå™¨
        // galleryIndicator.textContent = `${galleryCurrentIndex + 1} / ${galleryCurrentList.length}`;
    }

    function showGalleryModal() {
        if (photoLinks.length === 0) {
             showTextModal('ğŸ’”', 'ç…§ç‰‡è¿˜åœ¨è·¯ä¸Šï¼Œè¯·ç¨åå†è¯•ï¼');
             return;
        }
        galleryCurrentList = shuffleArray(photoLinks); // æ¯æ¬¡æ‰“å¼€éƒ½æ´—ç‰Œ
        galleryCurrentIndex = 0;
        displayGalleryItem();
        galleryModal.classList.remove('hidden');
        galleryModal.classList.add('flex');
    }
    
    function hideGalleryModal() {
        galleryModal.classList.add('hidden');
        galleryModal.classList.remove('flex');
    }
    
    function showNextPhoto() {
        galleryCurrentIndex++;
        if (galleryCurrentIndex >= galleryCurrentList.length) {
            galleryCurrentIndex = 0; // å¾ªç¯
        }
        displayGalleryItem();
    }
    
    function showPrevPhoto() {
        galleryCurrentIndex--;
        if (galleryCurrentIndex < 0) {
            galleryCurrentIndex = galleryCurrentList.length - 1; // å¾ªç¯
        }
        displayGalleryItem();
    }
    
    // V14: æ¢å¤ fetchPhotosFromGitHub() å‡½æ•°
    async function fetchPhotosFromGitHub() {
        const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO_NAME}/contents/`;
        const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp'];

        try {
            // V14: æ·»åŠ ä¸€ä¸ªéšæœºæŸ¥è¯¢å‚æ•°æ¥é˜²æ­¢APIç¼“å­˜
            const response = await fetch(apiUrl + '?t=' + new Date().getTime()); 
            if (!response.ok) {
                // å¦‚æœAPIå¤±è´¥, å°è¯•ä½¿ç”¨ V13 çš„æ‰‹åŠ¨åˆ—è¡¨ä½œä¸ºå¤‡ç”¨
                console.warn('GitHub API å¤±è´¥, æ­£åœ¨å°è¯•å¤‡ç”¨é“¾æ¥...');
                throw new Error(`GitHub API é”™è¯¯: ${response.statusText}`);
            }
            
            const files = await response.json();
            
            if (Array.isArray(files)) {
                files.forEach(file => {
                    if (file.type === 'file' && imageExtensions.some(ext => file.name.toLowerCase().endsWith(ext))) {
                        photoLinks.push(file.download_url); // ä½¿ç”¨ 'download_url'
                    }
                });
            }
            if (photoLinks.length === 0) {
                 // å¦‚æœAPIæˆåŠŸäº†ä½†æ²¡æ‰¾åˆ°ç…§ç‰‡, ä¹Ÿä½¿ç”¨å¤‡ç”¨åˆ—è¡¨
                console.warn('GitHub API æœªæ‰¾åˆ°ç…§ç‰‡, æ­£åœ¨å°è¯•å¤‡ç”¨é“¾æ¥...');
                throw new Error('åœ¨ä»“åº“ä¸­æ²¡æœ‰æ‰¾åˆ°å›¾ç‰‡æ–‡ä»¶ã€‚');
            }

            // åŠ è½½æˆåŠŸ
            memoryOpen.disabled = false;
            memoryOpen.innerHTML = '<span>ğŸ’–</span><span>æˆ‘ä»¬çš„å›å¿†</span>';
            memoryOpen.classList.remove('opacity-50', 'cursor-not-allowed');

        } catch (error) {
            console.error('åŠ è½½ GitHub ç…§ç‰‡å¤±è´¥:', error);
            // V15: è‡ªåŠ¨åŠ è½½å¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ (å·²ä¿®å¤æ–‡ä»¶å)
            // ä½¿ç”¨ V13 çš„æ‰‹åŠ¨é“¾æ¥åˆ—è¡¨
            photoLinks = [
                'https://raw.githubusercontent.com/haiyangw101661-oss/why/main/æœªå‘½å.jpg', // V15: ä¿®å¤äº†æ–‡ä»¶å
                'https://raw.githubusercontent.com/haiyangw101661-oss/why/main/2.jpg',
                'https://raw.githubusercontent.com/haiyangw101661-oss/why/main/3.jpg',
                'https://raw.githubusercontent.com/haiyangw101661-oss/why/main/4.jpg',
                'https://raw.githubusercontent.com/haiyangw101661-oss/why/main/5.jpg',
                'https://raw.githubusercontent.com/haiyangw101661-oss/why/main/6.jpg',
                'https://raw.githubusercontent.com/haiyangw101661-oss/why/main/7.jpg',
                'https://raw.githubusercontent.com/haiyangw101661-oss/why/main/8.jpg',
                'https://raw.githubusercontent.com/haiyangw101661-oss/why/main/9.jpg',
                'https://raw.githubusercontent.com/haiyangw101661-oss/why/main/10.jpg'
            ];
            
            // æ£€æŸ¥å¤‡ç”¨åˆ—è¡¨æ˜¯å¦ä¹Ÿä¸ºç©º
            if (photoLinks.length > 0) {
                // å¤‡ç”¨æ–¹æ¡ˆåŠ è½½æˆåŠŸ
                memoryOpen.disabled = false;
                memoryOpen.innerHTML = '<span>ğŸ’–</span><span>æˆ‘ä»¬çš„å›å¿†</span>';
                memoryOpen.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                // å½»åº•å¤±è´¥
                memoryOpen.innerHTML = '<span>ğŸ’”</span><span>ç…§ç‰‡åŠ è½½å¤±è´¥</span>';
                memoryOpen.classList.add('opacity-70');
                memoryOpen.disabled = true; 
            }
        }
    }

    /* ---------- V7: ç²’å­é›¨ ---------- */
    function createParticle() {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        particle.textContent = getRandomItem(particleTypes); 
        particle.style.left = Math.random() * 100 + 'vw';
        particle.style.animationDuration = (Math.random() * 5 + 5) + 's'; // 5-10ç§’
        particle.style.animationDelay = (Math.random() * -5) + 's'; // ç«‹å³å¼€å§‹
        
        particleContainer.appendChild(particle);
        
        // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
        particle.addEventListener('animationend', () => {
            particle.remove();
        });
    }

    /* ---------- V15: æ‰­è›‹æœºé‡ç½®åŠŸèƒ½ ---------- */
    function resetGacha() {
        if (gachaCount > 0) { // åªæœ‰ç‚¹å‡»è¿‡æ‰æç¤ºé‡ç½®
            gachaCount = 0;
            gachaText.textContent = "æ¬¡æ•°å·²é‡ç½®ï¼ âœ¨";
            gachaCountText.textContent = "ä»Šæ—¥å·²æ‰­ 0/3 æ¬¡";
            
            // V16: å°†é‡ç½®ä¿å­˜åˆ° localStorage
            const today = new Date().toLocaleDateString();
            localStorage.setItem('gachaCount', 0);
            localStorage.setItem('gachaDate', today);
        }
    }

    /* ---------- é¡µé¢åŠ è½½å’Œäº‹ä»¶ç»‘å®š ---------- */
    
    // é¡µé¢åŠ è½½æ—¶è¿è¡Œ
    window.onload = () => {
        // V14: å¯åŠ¨ç…§ç‰‡è·å–
        fetchPhotosFromGitHub();
        
        // V16: è·å–ä»Šå¤©çš„æ—¥æœŸ
        const today = new Date().toLocaleDateString(); // e.g., "11/16/2025"
        
        // V16: æ¯æ—¥æƒ…è¯é€»è¾‘
        const savedQuoteDate = localStorage.getItem('quoteDate');
        let quoteToDisplay = '';
        if (savedQuoteDate === today) {
            // ä»Šå¤©å·²ç»è®¿é—®è¿‡äº†, åŠ è½½ä¿å­˜çš„æƒ…è¯
            quoteToDisplay = localStorage.getItem('dailyQuote') || getRandomItem(dailyQuotes);
        } else {
            // æ–°çš„ä¸€å¤©, æŠ½ä¸€å¥æ–°çš„
            quoteToDisplay = getRandomItem(dailyQuotes);
            localStorage.setItem('dailyQuote', quoteToDisplay);
            localStorage.setItem('quoteDate', today);
        }
        todayQuoteText.textContent = quoteToDisplay;
        
        
        // V16: æ¯æ—¥æ‰­è›‹æ¬¡æ•°é€»è¾‘
        const savedGachaDate = localStorage.getItem('gachaDate');
        if (savedGachaDate === today) {
            // ä»Šå¤©å·²ç»è®¿é—®è¿‡äº†, åŠ è½½ä¿å­˜çš„æ¬¡æ•°
            gachaCount = parseInt(localStorage.getItem('gachaCount') || 0);
        } else {
            // æ–°çš„ä¸€å¤©, é‡ç½®æ¬¡æ•°
            gachaCount = 0;
            localStorage.setItem('gachaCount', 0);
            localStorage.setItem('gachaDate', today);
        }
        // V16: åˆå§‹åŒ–æ‰­è›‹æœºè®¡æ•°
        gachaCountText.textContent = `ä»Šæ—¥å·²æ‰­ ${gachaCount}/3 æ¬¡`;
        
        // é¢„çƒ­ç²’å­
        for (let i = 0; i < 15; i++) {
            createParticle();
        }
        // æŒç»­åˆ›å»ºç²’å­
        setInterval(createParticle, 500); 

    };
    
    // ç»‘å®šå¿ƒæƒ…æŒ‰é’®
    moodButtons.forEach(button => {
        button.addEventListener('click', () => {
            const mood = button.dataset.mood;
            const reply = getRandomItem(moodReplies[mood]);
            moodReplyText.textContent = reply;
        });
    });
    
    // V12: ç»‘å®šæ‰­è›‹æœºæŒ‰é’®
    gachaBtn.addEventListener('click', () => {
        // V16: è·å–ä»Šå¤©çš„æ—¥æœŸä»¥ä¿å­˜
        const today = new Date().toLocaleDateString();
        
        if (gachaCount >= 3) {
            gachaText.textContent = "åˆ«ç‚¹å•¦ï¼Œå†ç‚¹æˆ‘ä¹Ÿçˆ±ä½ ï¼";
            gachaCountText.textContent = "ä»Šæ—¥å·²æ‰­ 3/3 æ¬¡"; 
        } else {
            gachaCount++;
            const reply = getRandomItem(gachaReplies);
            gachaText.textContent = `â€œ${reply}â€`;
            gachaCountText.textContent = `ä»Šæ—¥å·²æ‰­ ${gachaCount}/3 æ¬¡`;
            
            // V16: å°†æ–°æ¬¡æ•°ä¿å­˜åˆ° localStorage
            localStorage.setItem('gachaCount', gachaCount);
            localStorage.setItem('gachaDate', today);
        }
    });

    // V15: ç»‘å®šæ‰­è›‹æœºè®¡æ•°å™¨ç‚¹å‡»äº‹ä»¶ (å½©è›‹)
    gachaCountText.addEventListener('click', resetGacha);

    // ç»‘å®šä¸‰å¤§åŠŸèƒ½æŒ‰é’®
    navLove.addEventListener('click', () => {
        showTextModal('ğŸ’Œ', getRandomItem(quotes.btn1));
    });
    navEnc.addEventListener('click', () => {
        showTextModal('âœ¨', getRandomItem(quotes.btn2));
    });
    navPraise.addEventListener('click', () => {
        showTextModal('ğŸ‰', getRandomItem(quotes.btn3));
    });
    
    // ç»‘å®šæ–‡æœ¬å¼¹çª—å…³é—­
    textModalClose.addEventListener('click', hideTextModal);

    // ç»‘å®šç…§ç‰‡ç”»å»ŠæŒ‰é’®
    memoryOpen.addEventListener('click', showGalleryModal);
    galleryClose.addEventListener('click', hideGalleryModal);
    galleryOverlay.addEventListener('click', hideGalleryModal);
    galleryNext.addEventListener('click', showNextPhoto);
    galleryPrev.addEventListener('click', showPrevPhoto);

  </script>
</body>
</html>